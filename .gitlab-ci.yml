image: docker:1.11
services:
 - docker:1.11-dind

gitlab-ce-test:
  variables:
    HOSTNAME: gitlab-qa.test
    GITLAB_URL: http://$HOSTNAME
  script:
    - docker network create --internal test
    - docker run -d --name gitlab-qa --net test --hostname $HOSTNAME gitlab/gitlab-ce:latest
    - docker run -t --net test -e GITLAB_URL:$GITLAB_URL -v $(pwd):/tests ruby:2.2 /tests/bin/run
