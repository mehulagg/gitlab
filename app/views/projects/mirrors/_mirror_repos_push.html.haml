- protocols = Gitlab::UrlSanitizer::ALLOWED_SCHEMES.join('|')

= f.fields_for :remote_mirrors, @project.remote_mirrors.build do |rm_f|
  = rm_f.hidden_field :enabled, value: '1'
  = rm_f.hidden_field :url, class: 'js-mirror-url-hidden', required: true, pattern: "(#{protocols}):\/\/.+"
  = rm_f.hidden_field :only_protected_branches, class: 'js-mirror-protected-hidden'
  = rm_f.hidden_field :keep_divergent_refs, class: 'js-mirror-keep-divergent-refs-hidden'
  = render partial: 'projects/mirrors/ssh_host_keys', locals: { f: rm_f }
  = render partial: 'projects/mirrors/authentication_method', locals: { f: rm_f }
  .form-check.gl-mb-3
    = check_box_tag :keep_divergent_refs, '1', false, class: 'js-mirror-keep-divergent-refs form-check-input'
    = label_tag :keep_divergent_refs, _('Keep divergent refs'), class: 'form-check-label'
    .form-text.text-muted
      = _('By default, if any ref (branches, tags) on the remote mirror has diverged from the local repository, the entire push will fail, and nothing will be updated. Choose this option to override this behavior.')
      = link_to _('Read more'), help_page_path('user/project/repository/repository_mirroring', anchor: 'keep-divergent-refs'), target: '_blank'
  .form-check.gl-mb-3
    = check_box_tag :only_protected_branches, '1', false, class: 'js-mirror-protected form-check-input'
    = label_tag :only_protected_branches, _('Only mirror protected branches.'), class: 'form-check-label'
    .form-text.text-muted
      = _('If enabled, only protected branches will be mirrored.')
      = link_to _('Read more'), help_page_path('user/project/repository/repository_mirroring', anchor: 'push-only-protected-branches'), target: '_blank'
