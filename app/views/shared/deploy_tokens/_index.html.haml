- expanded = expand_deploy_tokens_section?(@new_deploy_token)

%section.qa-deploy-tokens-settings.settings.no-animate#js-deploy-tokens{ class: ('expanded' if expanded), data: { qa_selector: 'deploy_tokens_settings' } }
  .settings-header
    %h4= s_('DeployTokens|Deploy Tokens')
    %button.btn.js-settings-toggle.qa-expand-deploy-keys{ type: 'button' }
      = expanded ? 'Collapse' : 'Expand'
    %p
      = description
  .settings-content
    - if Feature.enabled?(:ajax_new_deploy_token, group_or_project)
      - container_registry_enabled = container_registry_enabled?(group_or_project)
      - create_new_token_path = create_deploy_token_path(group_or_project)
      #js-new-deploy-token{ data: { container_registry_enabled: container_registry_enabled, create_new_token_path: create_new_token_path } }
    - else
      - if @new_deploy_token.persisted?
        = render 'shared/deploy_tokens/new_deploy_token', deploy_token: @new_deploy_token
      %h5.prepend-top-0
        = s_('DeployTokens|Add a deploy token')
      = render 'shared/deploy_tokens/form', group_or_project: group_or_project, token: @new_deploy_token, presenter: @deploy_tokens
    %hr
    = render 'shared/deploy_tokens/table', group_or_project: group_or_project, active_tokens: @deploy_tokens

