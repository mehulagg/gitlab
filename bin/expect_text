#!/usr/bin/env bash
# Run the given SCRIPT and expect its output include the given EXPECTED_TEXT.
# If the expectation succeeds, exit with 0, otherwise exit with 1.
# This is useful when you want don't care about a script's exit code but only
# care about its output.

SCRIPT=$1
EXPECTED_TEXT=$2

mkdir -p gitlab-qa-run-expect_text
log_file="gitlab-qa-run-expect_text/log.txt"

if [ -z "$SCRIPT" ] || [ -z "$EXPECTED_TEXT" ]; then
  echo "Missing argument(s) - Use: $0 script expected_text"
else
  $SCRIPT | tee $log_file
  grep "$EXPECTED_TEXT" $log_file > /dev/null
fi
