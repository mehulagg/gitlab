# frozen_string_literal: true

class AddIndexOnVulnerabilityOccurrencePipelines < ActiveRecord::Migration[6.0]
  include Gitlab::Database::MigrationHelpers

  DOWNTIME = false
  INDEX_NAME = 'idx_vuln_occurrence_pipelines_on_pipeline_id_and_occurrence_id'

  disable_ddl_transaction!

  def up
    add_concurrent_index :vulnerability_occurrence_pipelines,
      [:pipeline_id, :occurrence_id],
      name: INDEX_NAME,
      using: :btree
  end

  def down
    remove_concurrent_index_by_name :vulnerability_occurrence_pipelines, INDEX_NAME
  end
end
