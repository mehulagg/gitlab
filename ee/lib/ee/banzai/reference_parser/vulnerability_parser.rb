# frozen_string_literal: true

module EE
  module Banzai
    module ReferenceParser
      module VulnerabilityParser
        def references_relation
          Vulnerability
        end

        # rubocop: disable CodeReuse/ActiveRecord
        def records_for_nodes(nodes)
          @vulnerabilities_for_nodes ||= grouped_objects_for_nodes(
            nodes,
            ::Vulnerability.includes(
              :author,
              :project
            ),
            self.class.data_attribute
          )
        end
        # rubocop: enable CodeReuse/ActiveRecord

        def can_read_reference?(user, vulnerability)
          can?(user, :read_vulnerability, vulnerability)
        end
      end
    end
  end
end
