<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="group" content="Configure">
<meta name="stage" content="Configure">
<meta name="info" content="To determine the technical writer assigned to the Stage/Group associated with this page, see https://about.gitlab.com/handbook/engineering/ux/technical-writing/#assignments"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAABE0AA8AAAAAHWwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY3d1HZY21hcAAAAdgAAACqAAACOvWLi0FjdnQgAAAChAAAABMAAAAgBtX/BGZwZ20AAAKYAAAFkAAAC3CKkZBZZ2FzcAAACCgAAAAIAAAACAAAABBnbHlmAAAIMAAABdQAAAjkYT9TNWhlYWQAAA4EAAAAMwAAADYQ6WvNaGhlYQAADjgAAAAfAAAAJAc6A1pobXR4AAAOWAAAACAAAAA0Kmz/7mxvY2EAAA54AAAAHAAAABwQPBJubWF4cAAADpQAAAAgAAAAIAEHC/NuYW1lAAAOtAAAAYQAAALxhQT4h3Bvc3QAABA4AAAAfgAAAMS3SYh9cHJlcAAAELgAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZHZmnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4Pwz+yMwf9z2KIYg5imAYUZgTJAQDcoQvQAHic7ZHNDYJAFIRnBXf94cDRIiyCKkCpwFCPJ092RcKNDoYKcN4+EmMPvpdvk539zQyAPYBCXEUJhBcCrJ5SQ9YLnLJe4qF5rdb+uWPDngNHTkta101pNyWa8lMhn6xx2dqUnW4q9YOIhAOOeueMSgsR/6ry+P7O5s6xVNg4chBsHUuFnWNJ8uZYwrw7chrsHXkODo7cB0dHOYCTY8kv0VE2WJKD6gOlWjsxAAB4nGNgQAMSEMgc9D8LhAESbAPdAHicrVZpd9NGFB15SZyELCULLWphxMRpsEYmbMGACUGyYyBdnK2VoIsUO+m+8Ynf4F/zZNpz6Dd+Wu8bLySQtOdwmpOjd+fN1czbZRJaktgL65GUmy/F1NYmjew8CemGTctRfCg7eyFlisnfBVEQrZbatx2HREQiULWusEQQ+x5ZmmR86FFGy7akV03KLT3pLlvjQb1V334aOsqxO6GkZjN0aD2yJVUYVaJIpj1S0qZlqPorSSu8v8LMV81QwohOImm8GcbQSN4bZ7TKaDW24yiKbLLcKFIkmuFBFHmU1RLn5IoJDMoHzZDyyqcR5cP8iKzYo5xWsEu20/y+L3mndzk/sV9vUbbkQB/Ijuzg7HQlX4RbW2HctJPtKFQRdtd3QmzZ7FT/Zo/ymkYDtysyvdCMYKl8hRArP6HM/iFZLZxP+ZJHo1qykRNB62VO7Es+gdbjiClxzRhZ0N3RCRHU/ZIzDPaYPh788d4plgsTAngcy3pHJZwIEylhczRJ2jByYCVliyqp9a6YOOV1WsRbwn7t2tGXzmjjUHdiPFsPHVs5UcnxaFKnmUyd2knNoykNopR0JnjMrwMoP6JJXm1jNYmVR9M4ZsaERCICLdxLU0EsO7GkKQTNoxm9uRumuXYtWqTJA/Xco/f05la4udNT2g70s0Z/VqdiOtgL0+lp5C/xadrlIkXp+ukZfkziQdYCMpEtNsOUgwdv/Q7Sy9eWHIXXBtju7fMrqH3WRPCkAfsb0B5P1SkJTIWYVYhWQGKta1mWydWsFqnI1HdDmla+rNMEinIcF8e+jHH9XzMzlpgSvt+J07MjLj1z7UsI0xx8m3U9mtepxXIBcWZ5TqdZlu/rNMfyA53mWZ7X6QhLW6ejLD/UaYHlRzodY3lBC5p038GQizDkAg6QMISlA0NYXoIhLBUMYbkIQ1gWYQjLJRjC8mMYwnIZhrC8rGXV1FNJ49qZWAZsQmBijh65zEXlaiq5VEK7aFRqQ54SbpVUFM+qf2WgXjzyhjmwFkiXyJpfMc6Vj0bl+NYVLW8aO1fAsepvH472OfFS1ouFPwX/1dZUJb1izcOTq/Abhp5sJ6o2qXh0TZfPVT26/l9UVFgL9BtIhVgoyrJscGcihI86nYZqoJVDzGzMPLTrdcuan8P9NzFCFlD9+DcUGgvcg05ZSVnt4KzV19uy3DuDcjgTLEkxN/P6VvgiI7PSfpFZyp6PfB5wBYxKZdhqA60VvNknMQ+Z3iTPBHFbUTZI2tjOBIkNHPOAefOdBCZh6qoN5E7hhg34BWFuwXknXKJ6oyyH7kXs8yik/Fun4kT2qGiMwLPZG2Gv70LKb3EMJDT5pX4MVBWhqRg1FdA0Um6oBl/G2bptQsYO9CMqdsOyrOLDxxb3lZJtGYR8pIjVo6Of1l6iTqrcfmYUl++dvgXBIDUxf3vfdHGQyrtayTJHbQNTtxqVU9eaQ+NVh+rmUfW94+wTOWuabronHnpf06rbwcVcLLD2bQ7SUiYX1PVhhQ2iy8WlUOplNEnvuAcYFhjQ71CKjf+r+th8nitVhdFxJN9O1LfR52AM/A/Yf0f1A9D3Y+hyDS7P95oTn2704WyZrqIX66foNzBrrblZugbc0HQD4iFHrY64yg18pwZxeqS5HOkh4GPdFeIBwCaAxeAT3bWM5lMAo/mMOT7A58xh0GQOgy3mMNhmzhrADnMY7DKHwR5zGHzBnHWAL5nDIGQOg4g5DJ4wJwB4yhwGXzGHwdfMYfANc+4DfMscBjFzGCTMYbCv6dYwzC1e0F2gtkFVoANTT1jcw+JQU2XI/o4Xhv29Qcz+wSCm/qjp9pD6Ey8M9WeDmPqLQUz9VdOdIfU3Xhjq7wYx9Q+DmPpMvxjLZQa/jHyXCgeUXWw+5++J9w/bxUC5AAEAAf//AA94nIVVX2hbZRQ/5/t7893s5ja9f7ouzdZ0TTqz3bRJmogbWya6bG6Cq0VbSV2ddIJjFtfIQHEig80Hda8yUN/0YQz8AyriiyD+xQd92R4HCnaCb3samnpumrpsCsLlfPf7zvedc37nL3CAtc/5W/wQZGA3tOBSY/g+TMjHmwzEoM1Q8+ZjRZY4oJhmBw5/YB6Za0yC5AkhlwA1A1yCBIBOwCII0Cj0U8BAMdUCzq05sKwkP7SlUY6fcJk4Fb/RyE79/6P5hjM/F4aZiXBoeMgzcqQ4Xi1hPqfDLG5FT+lchCVU3lYMyvuwhl1mqndQL0RsuloLywHtthLXI06OblTrhfWVnpSJ5+mwu/JdbtuN3IAnkW0LLMcRwaC7ktrlzridM6kVdyf9uO1UNBByI7JhwtG2sEwab07ORBeilWhqavJCqV0qzZTOl/7ZXQ5TbTcdcFelyGhhRDAQpdqp1FEX3w3cFTc1k9pJQkmm4ySCbSikxRP2QOfN+0tHS5MrpQuTU1Mk5nw0E5Xa0WvrOwDyGax9yB9ma6DAg82wHc43SAGTI4GjBWebOePAERFE8/AHaQpZASSTy8A4WwZiLQMQ82mFKATO0ILicRAoDm9p5P99E5b/fXG+kQYY3TYUuqmERWYoT0u/GNYL2q/4WB3LaVS+VynXsVYIcWw6DkCh3nX1D+VzlYN4LClF5yexSQos8exqZ3KVP+wtrC54u4Nznq6cq+xpMpUUnZ8FUYzE86ud0g28NOIv3Gj5/rmA3ABs7S/ywzFuQ4qyd6QxfNtiQIaEgp3w/entQg4Vcbqa16M5FfpeUB8t1+qeg7mI7cUyOe79wOk86gSxkVec4KPTX69++5x68Yubn5/F+w52z7u08sJX7fZXv8ekT/d2mILJxq6sn+SC6qEJknzLJCxyZEKwWVqYmAPBxBE/9DLeZiWHu7lcr/VytrCRuHojncNuTt9h46tmacmYisnSamdN2bZptcsmSysdVsy1PrOvOzF3xN64Rb937t/og9KHxYdcjIUqFAmIAHGHNzlns+RTPgeUYAQm9DwpNxfxbhhBHPaw3/gfTcXO2L+eJVIx5nsyGkvm9X4/f+bGkH45G0PaSjcMXTjcZyTvi3UdHoCDjQd3IDUVsgwYmUoJK/gp4JJxeRI0MKHZIkgynyIBqBTOUs6rOVCojvjZ4mCQz49ZMlMcp8QoYk6NoBfsxnJtsBohpa8iGJS+ZH7gU7NxME6cmF+t7cO9vB8d3jTWSct0ycW9ranXmolNDwmVkNnxe+8JtoztwS5rKJ0xWS95tQ/1zMYzg69MzUZnNtl1ofNbsml/OJm6f9wjRjpnu2o4MzHzn77IQkRd+1DjwMQ2pqSjGMMhyjrgTbBAKksuUm0iU7hI0aN2wOKOq7WYBSH0HGihj/jkiPxAfmwsEbfYrjMG+j3ij932Db/LV7I/xruNrhnroxjR9HRMb2nTvO0ZXOoHPk8H2ZhDPx93qcE/53sH5np/dkIP7zzhTVKdR/BAY/9ElkkR+A6lJGsqpJ4oQcTxpvBT3Kn58VkaJjgHyPEIws57xkaHh9KuVpDEpJZeMbZ5w/zBHi5NMQ4r5VphsFqID7TyB9eR4pX216c3AHxpdAwoqU9qg0ZJ6yVLKmMSz1iG2z27ifx18NkY0LPx1W/wCc2l5LrznrIsiKsqbmB78A9wIGx4tI8rjihVHJyY9pgMirenVq0yWg7Iw7eogG7ZgYM3qR9959A/fZkg6MnD/exlkmc+jWV4SB15XUR+eqC6l6ZmgPtN9z5JMfik05OV8ljylunJ4J+wA/FUaQSSKotsYsCWqaPBidBLcxkWx7XKFRIb45TGaEhjlF9uUVPqXOtcIwsXbBvfoZXIyRYFdkfnqjExH98xpnPczqzjX/uNdO1Y17Wpi5+6Ts8BXtjVFasp9KZ1mOiNbH65c5w6HgmyF2jFCZywM8mWjRc7T5Pmt0lRy7Y71+jYbpGyvwG4sH0XeJxjYGRgYADiwBB/53h+m68M3MwvgCIM1z5N/g6j///9v5H5BbMnkMvBwAQSBQCIcA9gAHicY2BkYGAO+p8FJF/8//v/F/MLBqAICuAFALYQB5kAeJxjfsHAwLwAiCNB+P9fbJjJmoGBMRUo/wKCAfO2EnQAAAAAANoBXgGcAgICVALaA1IDvAPkBAYEPARyAAEAAAANAF0ABAAAAAAAAgAUACQAcwAAAG4LcAAAAAB4nHWRzWrCQBSFT+pPqUIXLXTTzayKUohGKIibCoLuhbrrYtTRxCYZmYyKyz5Fd32HvlDfoO/QkziIFJtw9bvnnpl7ZwLgBt/wcHieGAf2UGd24Atcou+4RH3kuEweO66QXx1XyaHjGh6ROa7jFp/cwStfMVvhy7GHO+/e8QWuvcBxifqz4zL5xXGF/Oa4Sn53XMPE+3Bcx4P3M9DrvYmWoRWNQVN02kFXTPdCU4pSGQu5saE2meiLhU6timPtz3SSs9ypTCdqrJabWJoT5QQnymSRTkXgt0/UkUqVkVbN807ZdtmxdiEWRidi6HqItdErNbN+aO2612qd9sYAGmvsYRBhyUu0EGhQbfK/gzYCdElTOgSdB1eEFBIxFYkNV4RFJWPeZyyYpVQVHTHZx4y/yVGX2LGWFZri51TccUOn5B7nPefVCSPvGhVVwUl9znveO2KkhV8Wk82PZ8qwZf8OVcu1+fSmWCMw/HMOwXvKaysqM+p+cVuWag8tvv+c+xdd+4+teJxtjUEOwiAURJla24KliQfhUA2g/Sl+CKXx+loNrpzVezOLEY34Ron/0WhwQoszOvQYIKFwwQiNSbSBeO2SZ0tBP4j3zVjKNng32ZmtD1VVXCuOiw/pJ8S3WOU6l+K5UOTaDC4+2TjKMtN9KQf1ezLx/Sg/00FCvABHhjDjAAB4nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjEwMmiBGJu5mBg5ICw+BjCLzWkX0wGgNCeQze60i8EBwmZmcNmowtgRGLHBoSNiI3OKy0Y1EG8XRwMDI4tDR3JIBEhJJBBs5mFi5NHawfi/dQNL70YmBhcADHYj9AAA) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>add_eks_clusters</title></head><body><article class="markdown-body"><h1 id="eks-clusters-free">EKS clusters <strong>(FREE)</strong><a class="headerlink" href="#eks-clusters-free" title="Permanent link"></a></h1>
<blockquote>
<p><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/22392">Introduced</a> in GitLab 12.5.</p>
</blockquote>
<p>GitLab supports adding new and existing EKS clusters.</p>
<p>Prerequisites:</p>
<ul>
<li>An <a href="https://aws.amazon.com/">Amazon Web Services</a> account.</li>
<li>Permissions to manage IAM resources.</li>
<li>If you want to use an <a href="#existing-eks-cluster">existing EKS cluster</a>:</li>
<li>An Amazon EKS cluster with worker nodes properly configured.</li>
<li><code>kubectl</code> <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html#get-started-kubectl">installed and configured</a>
    for access to the EKS cluster.</li>
</ul>
<p>For instance-level clusters, see <a href="#additional-requirements-for-self-managed-instances">Additional requirements for self-managed instances</a></p>
<p>To create a new cluster:</p>
<ol>
<li>Configure Amazon authentication.</li>
<li>Create a new cluster from the GitLab UI.</li>
</ol>
<h2 id="configure-amazon-authentication">Configure Amazon authentication<a class="headerlink" href="#configure-amazon-authentication" title="Permanent link"></a></h2>
<p>To configure Amazon authentication in GitLab, generate an access key for the IAM user in the Amazon AWS console, and following the steps below.</p>
<p>From GitLab 13.7 onwards, </p>
<ol>
<li>Navigate to <strong>Admin Area &gt; Settings &gt; General</strong> and expand the <strong>Amazon EKS</strong> section.</li>
<li>Check <strong>Enable Amazon EKS integration</strong>.</li>
<li>Enter your <strong>Account ID</strong>.</li>
<li>Depending on your configuration, enter your access key and ID:</li>
</ol>
<ul>
<li><em>GitLab 13.7 and later, and using an instance profile</em>: You may leave
     <strong>Access key ID</strong> and <strong>Secret access key</strong> blank.
     Read <a href="#instance-profiles">Instance profiles</a> for more information.</li>
<li><em>All GitLab versions</em>: Enter your access key credentials into
     <strong>Access key ID</strong> and <strong>Secret access key</strong>.</li>
</ul>
<ol>
<li>Click <strong>Save changes</strong>.</li>
</ol>
<h4 id="instance-profiles">Instance profiles<a class="headerlink" href="#instance-profiles" title="Permanent link"></a></h4>
<blockquote>
<p>Introduced in <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/291015">GitLab 13.7</a>.</p>
</blockquote>
<p>Instance profiles dynamically retrieve temporary credentials from AWS when needed.</p>
<p>You may leave <code>Access key ID</code> and <code>Secret access key</code> fields blank if
you are using an instance profile
<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html">to pass an IAM role to an EC2 instance</a>.</p>
<h2 id="create-a-new-eks-cluster">Create a new EKS cluster<a class="headerlink" href="#create-a-new-eks-cluster" title="Permanent link"></a></h2>
<p>To create and add a new Kubernetes cluster to your project, group, or instance:</p>
<ol>
<li>Navigate to your:
   - Project&rsquo;s <strong>Operations &gt; Kubernetes</strong> page, for a project-level cluster.
   - Group&rsquo;s <strong>Kubernetes</strong> page, for a group-level cluster.
   - <strong>Admin Area &gt; Kubernetes</strong>, for an instance-level cluster.</li>
<li>Click <strong>Integrate with a cluster certificate</strong>.</li>
<li>Under the <strong>Create new cluster</strong> tab, click <strong>Amazon EKS</strong> to display an
   <code>Account ID</code> and <code>External ID</code> needed for later steps.</li>
<li>In the <a href="https://console.aws.amazon.com/iam/home">IAM Management Console</a>, create an IAM policy:</li>
<li>From the left panel, select <strong>Policies</strong>.</li>
<li>Click <strong>Create Policy</strong>, which opens a new window.</li>
<li>
<p>Select the <strong>JSON</strong> tab, and paste the following snippet in place of the
      existing content. These permissions give GitLab the ability to create
      resources, but not delete them:</p>
<div class="highlight"><pre><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;autoscaling:CreateAutoScalingGroup&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:DescribeAutoScalingGroups&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:DescribeScalingActivities&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:UpdateAutoScalingGroup&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:CreateLaunchConfiguration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;autoscaling:DescribeLaunchConfigurations&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:CreateStack&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cloudformation:DescribeStacks&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:AuthorizeSecurityGroupEgress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:AuthorizeSecurityGroupIngress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:RevokeSecurityGroupEgress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:RevokeSecurityGroupIngress&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:CreateSecurityGroup&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:createTags&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeImages&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeKeyPairs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeRegions&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeSecurityGroups&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeSubnets&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ec2:DescribeVpcs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eks:CreateCluster&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eks:DescribeCluster&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:AddRoleToInstanceProfile&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:AttachRolePolicy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:CreateRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:CreateInstanceProfile&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:CreateServiceLinkedRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:GetRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:listAttachedRolePolicies&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:ListRoles&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iam:PassRole&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ssm:GetParameters&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<p>If an error is encountered during the creation process, changes will
  not be rolled back and you must remove resources manually. You can do this by deleting
  the relevant <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-delete-stack.html">CloudFormation stack</a></p>
</li>
<li>
<p>Click <strong>Review policy</strong>.</p>
</li>
<li>
<p>Enter a suitable name for this policy, and click <strong>Create Policy</strong>. You can now close this window.</p>
</li>
<li>
<p>In the <a href="https://console.aws.amazon.com/iam/home">IAM Management Console</a>, create an <strong>EKS IAM role</strong> following the <a href="https://docs.aws.amazon.com/eks/latest/userguide/service_IAM_role.html">Amazon EKS cluster IAM role instructions</a>. This role should exist so that Kubernetes clusters managed by Amazon EKS can make calls to other AWS services on your behalf to manage the resources that you use with the service.
   In addition to the policies that guide suggests, you must also include the <code>AmazonEKSClusterPolicy</code>
   policy for this role in order for GitLab to manage the EKS cluster correctly.</p>
</li>
<li>In the <a href="https://console.aws.amazon.com/iam/home">IAM Management Console</a>, create another IAM role which will be used by GitLab to authenticate with AWS. Follow these steps to create it:</li>
<li>On the AWS IAM console, select <strong>Roles</strong> from the left panel.</li>
<li>Click <strong>Create role</strong>.</li>
<li>Under <code>Select type of trusted entity</code>, select <strong>Another AWS account</strong>.</li>
<li>Enter the Account ID from GitLab into the <code>Account ID</code> field.</li>
<li>Check <strong>Require external ID</strong>.</li>
<li>Enter the External ID from GitLab into the <code>External ID</code> field.</li>
<li>Click <strong>Next: Permissions</strong>, and select the policy you just created.</li>
<li>Click <strong>Next: Tags</strong>, and optionally enter any tags you wish to associate with this role.</li>
<li>Click <strong>Next: Review</strong>.</li>
<li>Enter a role name and optional description into the fields provided.</li>
<li>Click <strong>Create role</strong>, the new role name displays at the top. Click on its name and copy the <code>Role ARN</code> from the newly created role.</li>
<li>In GitLab, enter the copied role ARN into the <code>Role ARN</code> field.</li>
<li>In the <strong>Cluster Region</strong> field, enter the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">region</a> you plan to use for your new cluster. GitLab confirms you have access to this region when authenticating your role.</li>
<li>Click <strong>Authenticate with AWS</strong>.</li>
<li>
<p>Choose your cluster&rsquo;s settings:
   - <strong>Kubernetes cluster name</strong> - The name you wish to give the cluster.
   - <strong>Environment scope</strong> - The <a href="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/index.md#setting-the-environment-scope">associated environment</a> to this cluster.
   - <strong>Kubernetes version</strong> - The <a href="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/index.md#supported-cluster-versions">Kubernetes version</a> to use.
   - <strong>Service role</strong> - Select the <strong>EKS IAM role</strong> you created earlier to allow Amazon EKS
     and the Kubernetes control plane to manage AWS resources on your behalf.</p>
<p>NOTE:
 This IAM role is <em>not</em> the IAM role you created in the previous step. It should be
 the one you created much earlier by following the
 <a href="https://docs.aws.amazon.com/eks/latest/userguide/service_IAM_role.html">Amazon EKS cluster IAM role</a>
 guide.
   - <strong>Key pair name</strong> - Select the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html">key pair</a>
 that you can use to connect to your worker nodes if required.
   - <strong>VPC</strong> - Select a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html">VPC</a>
 to use for your EKS Cluster resources.
   - <strong>Subnets</strong> - Choose the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html">subnets</a>
 in your VPC where your worker nodes run. You must select at least two.
   - <strong>Security group</strong> - Choose the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html">security group</a>
 to apply to the EKS-managed Elastic Network Interfaces that are created in your worker node subnets.
   - <strong>Instance type</strong> - The <a href="https://aws.amazon.com/ec2/instance-types/">instance type</a> of your worker nodes.
   - <strong>Node count</strong> - The number of worker nodes.
   - <strong>GitLab-managed cluster</strong> - Leave this checked if you want GitLab to manage namespaces and service accounts for this cluster.
 See the <a href="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/index.md#gitlab-managed-clusters">Managed clusters section</a> for more information.
1. Finally, click the <strong>Create Kubernetes cluster</strong> button.</p>
</li>
</ol>
<p>After about 10 minutes, your cluster is ready to go. You can now proceed
to install some <a href="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/index.md#installing-applications">pre-defined applications</a>.</p>
<p>NOTE:
If you have <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html#get-started-kubectl">installed and configured</a>  <code>kubectl</code>  and you would like to manage your cluster with it, you must add your AWS external ID in the AWS configuration. For more information on how to configure AWS CLI, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html#cli-configure-role-xaccount">using an IAM role in the AWS CLI</a>.</p>
<h3 id="cluster-creation-flow">Cluster creation flow<a class="headerlink" href="#cluster-creation-flow" title="Permanent link"></a></h3>
<p>The following sequence illustrates how GitLab works with AWS to create an EKS cluster:</p>
<div class="highlight"><pre>sequenceDiagram
    autonumber
    participant G as GitLab
    participant A as AWS
    participant E as EKS cluster
    alt static credentials
      G-&gt;&gt;G: Load AWS Access and secret key
    end
    alt IAM instance profile
      G-&gt;&gt;A: Fetch temporary credentials
      A-&gt;&gt;G: Temporary access credentials
    end
    G-&gt;&gt;A: AssumeRole: EKS Provision Role
    A-&gt;&gt;A: Check account, external IDs
    A-&gt;&gt;A: Check permissions
    A-&gt;&gt;G: New access credentials
    note over G: user selects EKS cluster options
    note over G,A: Use Service Role credentials
    G-&gt;&gt;A: CreateStack (CloudFormation)
    A-&gt;&gt;G: Received
    G-&gt;&gt;G: Wait 5 minutes
    loop Poll for cluster creation
      G-&gt;&gt;A: DescribeStacks
      A-&gt;&gt;G: CREATE_IN_PROGRESS
    end
    note over G,E: EKS Cluster Created
    G-&gt;&gt;A: DescribeStacks
    A-&gt;&gt;G: CREATE_COMPLETE
    G-&gt;&gt;E: kubectl create role (service account)
    E-&gt;&gt;G: OK
</pre></div>

<p>First, GitLab must obtain an initial set of credentials to communicate with the AWS API.
These credentials can be retrieved in one of two ways:</p>
<ul>
<li>Statically through the <a href="#configure-amazon-authentication">Configure Amazon authentication</a>.</li>
<li>Dynamically via an IAM instance profile (<a href="https://gitlab.com/gitlab-org/gitlab/-/issues/291015">introduced</a> in GitLab 13.7).</li>
</ul>
<p>After GitLab retrieves the AWS credentials, it makes an
<a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AssumeRole</a>
API call to obtain credentials for the Provision Role. AWS confirms
the request has the correct account ID, external ID, and permissions.</p>
<p>If the request is valid, AWS returns a new set of temporary credentials GitLab
uses to load the <strong>Create cluster</strong> options page.</p>
<p>On the <strong>Create cluster</strong> page, the user must select a <strong>Service Role</strong>, which is
the IAM role that is actually used to create the cluster, and other options
such as the Kubernetes cluster name, Kubernetes version, and region.
After the user clicks the <strong>Create Kubernetes cluster</strong> button, GitLab
submits a CloudFormation API request to create an EKS cluster with the given parameters
from the user. GitLab waits 5 minutes before checking whether the cluster was created,
and polls once a minute for up to 30 minutes.</p>
<p>After GitLab receives a <code>CREATE_COMPLETE</code> message from AWS, GitLab talks
to the EKS cluster to create a Kubernetes service account with <code>cluster-admin</code>
privileges, and updates its internal database to reflect the newly-created
Kubernetes cluster. From this point forward, GitLab uses this service account to
interact with the cluster.</p>
<h2 id="additional-requirements-for-self-managed-instances-free-self">Additional requirements for self-managed instances <strong>(FREE SELF)</strong><a class="headerlink" href="#additional-requirements-for-self-managed-instances-free-self" title="Permanent link"></a></h2>
<p>If you are using a self-managed GitLab instance, GitLab must first be configured with a set of
Amazon credentials. These credentials are used to assume an Amazon IAM role provided by the user
creating the cluster. Create an IAM user and ensure it has permissions to assume the role(s) that
your users need to create EKS clusters.</p>
<p>For example, the following policy document allows assuming a role whose name starts with
<code>gitlab-eks-</code> in account <code>123456789012</code>:</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::123456789012:role/gitlab-eks-*&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="troubleshooting-creating-a-new-cluster">Troubleshooting creating a new cluster<a class="headerlink" href="#troubleshooting-creating-a-new-cluster" title="Permanent link"></a></h3>
<p>The following errors are commonly encountered when creating a new cluster.</p>
<h4 id="validation-failed-role-arn-must-be-a-valid-amazon-resource-name">Validation failed: Role ARN must be a valid Amazon Resource Name<a class="headerlink" href="#validation-failed-role-arn-must-be-a-valid-amazon-resource-name" title="Permanent link"></a></h4>
<p>Check that the <code>Provision Role ARN</code> is correct. An example of a valid ARN:</p>
<div class="highlight"><pre>arn:aws:iam::123456789012:role/gitlab-eks-provision&#39;
</pre></div>

<h4 id="access-denied-user-arnawsiamx-is-not-authorized-to-perform-stsassumerole-on-resource-arnawsiamy">Access denied: User <code>arn:aws:iam::x</code> is not authorized to perform: <code>sts:AssumeRole</code> on resource: <code>arn:aws:iam::y</code><a class="headerlink" href="#access-denied-user-arnawsiamx-is-not-authorized-to-perform-stsassumerole-on-resource-arnawsiamy" title="Permanent link"></a></h4>
<p>This error occurs when the credentials defined in the
<a href="#configure-amazon-authentication">Configure Amazon authentication</a> cannot assume the role defined by the
Provision Role ARN. Check that:</p>
<ol>
<li>The initial set of AWS credentials <a href="#additional-requirements-for-self-managed-instances">has the AssumeRole policy</a>.</li>
<li>The Provision Role has access to create clusters in the given region.</li>
<li>The account ID and
   <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-user_externalid.html">external ID</a>
   match the value defined in the <strong>Trust relationships</strong> tab in AWS:</li>
</ol>
<p><img alt="AWS IAM Trust relationships" src="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/img/aws_iam_role_trust.png" /></p>
<h4 id="could-not-load-security-groups-for-this-vpc">Could not load Security Groups for this VPC<a class="headerlink" href="#could-not-load-security-groups-for-this-vpc" title="Permanent link"></a></h4>
<p>When populating options in the configuration form, GitLab returns this error
because GitLab has successfully assumed your provided role, but the role has
insufficient permissions to retrieve the resources needed for the form. Make sure
you&rsquo;ve assigned the role the correct permissions.</p>
<h3 id="key-pairs-are-not-loaded">Key Pairs are not loaded<a class="headerlink" href="#key-pairs-are-not-loaded" title="Permanent link"></a></h3>
<p>GitLab loads the key pairs from the <strong>Cluster Region</strong> specified. Ensure that key pair exists in that region. </p>
<h4 id="rollback_failed-during-cluster-creation"><code>ROLLBACK_FAILED</code> during cluster creation<a class="headerlink" href="#rollback_failed-during-cluster-creation" title="Permanent link"></a></h4>
<p>The creation process halted because GitLab encountered an error when creating
one or more resources. You can inspect the associated
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-view-stack-data-resources.html">CloudFormation stack</a>
to find the specific resources that failed to create.</p>
<p>If the <code>Cluster</code> resource failed with the error
<code>The provided role doesn't have the Amazon EKS Managed Policies associated with it.</code>,
the role specified in <strong>Role name</strong> is not configured correctly.</p>
<p>NOTE:
This role should be the role you created by following the
<a href="https://docs.aws.amazon.com/eks/latest/userguide/service_IAM_role.html">EKS cluster IAM role</a> guide.
In addition to the policies that guide suggests, you must also include the
<code>AmazonEKSClusterPolicy</code> policy for this role in order for GitLab to manage the EKS cluster correctly.</p>
<h2 id="existing-eks-cluster">Existing EKS cluster<a class="headerlink" href="#existing-eks-cluster" title="Permanent link"></a></h2>
<p>For information on adding an existing EKS cluster, see
<a href="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/add_remove_clusters.md#existing-kubernetes-cluster">Existing Kubernetes cluster</a>.</p>
<h3 id="create-a-default-storage-class">Create a default Storage Class<a class="headerlink" href="#create-a-default-storage-class" title="Permanent link"></a></h3>
<p>Amazon EKS doesn&rsquo;t have a default Storage Class out of the box, which means
requests for persistent volumes are not automatically fulfilled. As part
of Auto DevOps, the deployed PostgreSQL instance requests persistent storage,
and without a default storage class it cannot start.</p>
<p>If a default Storage Class doesn&rsquo;t already exist and is desired, follow Amazon&rsquo;s
<a href="https://docs.aws.amazon.com/eks/latest/userguide/storage-classes.html">guide on storage classes</a>
to create one.</p>
<p>Alternatively, disable PostgreSQL by setting the project variable
<a href="/Users/ramosmd/GitLab/gitlab-ee/doc/topics/autodevops/customize.md#cicd-variables"><code>POSTGRES_ENABLED</code></a> to <code>false</code>.</p>
<h3 id="deploy-the-app-to-eks">Deploy the app to EKS<a class="headerlink" href="#deploy-the-app-to-eks" title="Permanent link"></a></h3>
<p>With RBAC disabled and services deployed,
<a href="/Users/ramosmd/GitLab/gitlab-ee/doc/topics/autodevops/index.md">Auto DevOps</a> can now be leveraged
to build, test, and deploy the app.</p>
<p><a href="/Users/ramosmd/GitLab/gitlab-ee/doc/topics/autodevops/index.md#at-the-project-level">Enable Auto DevOps</a>
if not already enabled. If a wildcard DNS entry was created resolving to the
Load Balancer, enter it in the <code>domain</code> field under the Auto DevOps settings.
Otherwise, the deployed app isn&rsquo;t externally available outside of the cluster.</p>
<p><img alt="Deploy Pipeline" src="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/img/pipeline.png" /></p>
<p>GitLab creates a new pipeline, which begins to build, test, and deploy the app.</p>
<p>After the pipeline has finished, your app runs in EKS, and is available
to users. Click on <strong>CI/CD &gt; Environments</strong>.</p>
<p><img alt="Deployed Environment" src="/Users/ramosmd/GitLab/gitlab-ee/doc/user/project/clusters/img/environment.png" /></p>
<p>GitLab displays a list of the environments and their deploy status, as well as
options to browse to the app, view monitoring metrics, and even access a shell
on the running pod.</p></article></body></html>